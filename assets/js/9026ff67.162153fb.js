"use strict";(self.webpackChunktouhouwiki_kr=self.webpackChunktouhouwiki_kr||[]).push([[3661],{28453:(e,n,t)=>{t.d(n,{R:()=>s,x:()=>c});var r=t(96540);const a={},o=r.createContext(a);function s(e){const n=r.useContext(o);return r.useMemo((function(){return"function"==typeof e?e(n):{...n,...e}}),[n,e])}function c(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(a):e.components||a:s(e.components),r.createElement(o.Provider,{value:n},e.children)}},70441:(e,n,t)=>{t.r(n),t.d(n,{assets:()=>Y,contentTitle:()=>Q,default:()=>z,frontMatter:()=>D,metadata:()=>r,toc:()=>Z});const r=JSON.parse('{"id":"toy/gacha","title":"\uac00\ucc60","description":"\uac00\ucc60","source":"@site/docs/toy/gacha.md","sourceDirName":"toy","slug":"/toy/gacha","permalink":"/touhouwiki-kr/docs/toy/gacha","draft":false,"unlisted":false,"editUrl":"https://github.com/wealthygogi/touhouwiki-kr/tree/main/docs/toy/gacha.md","tags":[],"version":"current","frontMatter":{"id":"gacha","title":"\uac00\ucc60","sidebar_label":"\uac00\ucc60"},"sidebar":"toySidebar","previous":{"title":"\uce90\ub9ad\ud130 \uce94\ubc84\uc2a4","permalink":"/touhouwiki-kr/docs/toy/character-canvas"},"next":{"title":"\uc790\uae30\uc18c\uac1c\uc11c","permalink":"/touhouwiki-kr/docs/toy/introduce"}}');var a=t(74848),o=t(28453),s=t(96540),c=t(86025);const l="container_Za5t",i="categorySelector_TTTX",u="categoryButtons_F0Hf",d="advancedControls_uo2K",h="controlRow_RTDg",m="controlLabel_WUp8",_="segmented_rFnp",k="segmentButton_Y5l1",f="segmentActive_XHJg",g="workSelect_i1vb",j="datasetStatus_yXvE",w="datasetError_yZEQ",p="categoryButton_b7lf",x="active_IC_p",b="slotContainer_Renq",v="controls_kaWR",y="gachaButton_S3L1",N="spinning_lIR3",M="result_rcta",C="resultItem_Ls7k",S="meta_QHjf",W="sourceWork_XGYk",E="flashing_VCtE",$="resetButton_XxdU",I=[{id:"game",name:"\uac8c\uc784",color:"#ff6b6b"},{id:"character",name:"\uce90\ub9ad\ud130",color:"#4ecdc4"}];function R(e){return"object"==typeof e&&null!==e}function A(e){return"string"==typeof e?e:null}function T(e){return"game"===e||"music"===e||"book"===e||"unknown"===e?e:"unknown"}function B(e){if(!R(e))return null;const n=A(e.id);return n?{id:n,type:T(e.type),name_ko:A(e.name_ko)||"",name_ja:A(e.name_ja)||"",name_en:A(e.name_en)||""}:null}function F(e){if(!R(e))return null;const n=A(e.id);if(!n)return null;const t=A(e.source_work_id),r=A(e.group_sub_ja)||"";return{id:n,name_ko:A(e.name_ko)||"",name_ja:A(e.name_ja)||"",name_en:A(e.name_en)||"",source_work_id:t??null,group_sub_ja:r}}let X=null,J=null;async function L(e){return X||(J||(J=fetch(e).then((async e=>{if(!e.ok)throw new Error(`Failed to load dataset: ${e.status} ${e.statusText}`);return function(e){if(!R(e))throw new Error("Invalid dataset: expected object");const n=e.works,t=e.characters;if(!Array.isArray(n)||!Array.isArray(t))throw new Error("Invalid dataset: expected works[] and characters[]");const r=[];for(const o of n){const e=B(o);e&&r.push(e)}const a=[];for(const o of t){const e=F(o);e&&a.push(e)}return{works:r,characters:a}}(await e.json())})).then((e=>(X=e,e))).finally((()=>{J=null})),J))}function P(e,n,t){return e||n||t||"(unknown)"}function H(e){return"\u5171\u901a"===e.group_sub_ja}const U=()=>{const[e,n]=(0,s.useState)("game"),[t,r]=(0,s.useState)(!1),[o,R]=(0,s.useState)(null),[A,T]=(0,s.useState)(!1),[B,F]=(0,s.useState)(""),X=(0,c.Ay)("/data/touhou_normalized.json"),[J,U]=(0,s.useState)(null),[D,Q]=(0,s.useState)(!1),[Y,Z]=(0,s.useState)(null),[q,z]=(0,s.useState)("all"),[G,K]=(0,s.useState)("global"),[O,V]=(0,s.useState)(""),ee=(0,s.useRef)(null);I.find((n=>n.id===e));(0,s.useEffect)((()=>()=>{null!=ee.current&&(window.clearInterval(ee.current),ee.current=null)}),[]),(0,s.useEffect)((()=>{let e=!1;if(!J)return Q(!0),Z(null),L(X).then((n=>{e||U(n)})).catch((n=>{if(e)return;const t=n instanceof Error?n.message:"Failed to load dataset";Z(t)})).finally((()=>{e||Q(!1)})),()=>{e=!0}}),[X,J]);const ne=(0,s.useMemo)((()=>{const e=new Map;for(const n of J?.works||[])e.set(n.id,n);return e}),[J]),te=(0,s.useMemo)((()=>(J?.characters||[]).filter(H)),[J]),re=(0,s.useMemo)((()=>(J?.works||[]).filter((e=>"game"===e.type))),[J]),ae=(0,s.useMemo)((()=>{const e=new Set;for(const n of J?.characters||[])n.source_work_id&&e.add(n.source_work_id);return e}),[J]),oe=(0,s.useMemo)((()=>{const e=Array.from(ae);return e.sort(((e,n)=>{const t=ne.get(e),r=ne.get(n),a=t?P(t.name_ko,t.name_en,t.name_ja):e,o=r?P(r.name_ko,r.name_en,r.name_ja):n;return a.localeCompare(o)})),e.map((e=>{const n=ne.get(e);return{id:e,label:n?P(n.name_ko,n.name_en,n.name_ja):e}}))}),[ae,ne]);(0,s.useEffect)((()=>{"character"===e&&"singleWork"===q&&(O||oe.length&&V(oe[0].id))}),[q,e,O,oe]);const se=(0,s.useMemo)((()=>{const e=J?.characters||[];return"all"===q?e:O?e.filter((e=>e.source_work_id===O||H(e))):[]}),[q,J,O]),ce=(0,s.useMemo)((()=>{const e=new Map;for(const n of se){if(!n.source_work_id)continue;const t=e.get(n.source_work_id)||[];t.push(n),e.set(n.source_work_id,t)}return e}),[se]),le=(0,s.useMemo)((()=>!D&&(!Y&&(!!J&&("game"===e?re.length>0:"character"===e&&se.length>0)))),[se.length,J,Y,D,re.length,e]),ie=()=>{R(null),T(!1),F("")};return(0,a.jsxs)("div",{className:l,children:[(0,a.jsxs)("div",{className:i,children:[(0,a.jsx)("h3",{children:"\uce74\ud14c\uace0\ub9ac \uc120\ud0dd"}),(0,a.jsx)("div",{className:u,children:I.map((r=>(0,a.jsx)("button",{className:`${p} ${e===r.id?x:""}`,style:{backgroundColor:r.color},onClick:()=>{n(r.id),ie()},disabled:t,children:r.name},r.id)))}),(0,a.jsxs)("div",{className:j,children:[D&&(0,a.jsx)("span",{children:"\ub370\uc774\ud130 \ub85c\ub529 \uc911..."}),!D&&Y&&(0,a.jsx)("span",{className:w,children:Y})]}),"character"===e&&(0,a.jsxs)("div",{className:d,children:[(0,a.jsxs)("div",{className:h,children:[(0,a.jsx)("div",{className:m,children:"\uc791\ud488 \ubc94\uc704"}),(0,a.jsxs)("div",{className:_,children:[(0,a.jsx)("button",{type:"button",className:`${k} ${"all"===q?f:""}`,onClick:()=>{z("all"),ie()},disabled:t,children:"\uc804\uccb4"}),(0,a.jsx)("button",{type:"button",className:`${k} ${"singleWork"===q?f:""}`,onClick:()=>{z("singleWork"),ie()},disabled:t,children:"\ud2b9\uc815 \uc791\ud488"})]}),"singleWork"===q&&(0,a.jsx)("select",{className:g,value:O,onChange:e=>{V(e.target.value),ie()},disabled:t||D||!!Y,children:oe.map((e=>(0,a.jsx)("option",{value:e.id,children:e.label},e.id)))})]}),(0,a.jsxs)("div",{className:h,children:[(0,a.jsx)("div",{className:m,children:"\ub864 \ubc29\uc2dd"}),(0,a.jsxs)("div",{className:_,children:[(0,a.jsx)("button",{type:"button",className:`${k} ${"global"===G?f:""}`,onClick:()=>{K("global"),ie()},disabled:t,children:"\uc804\uccb4 \uce90\ub9ad\ud130 \ud480"}),(0,a.jsx)("button",{type:"button",className:`${k} ${"byWork"===G?f:""}`,onClick:()=>{K("byWork"),ie()},disabled:t,children:"\uc791\ud488 \uae30\ubc18"})]})]}),!D&&!Y&&J&&(0,a.jsx)("div",{className:j,children:(0,a.jsxs)("span",{children:["\ub300\uc0c1 \uce90\ub9ad\ud130 ",se.length.toLocaleString(),"\uba85"]})})]})]}),(0,a.jsx)("div",{className:b,children:(0,a.jsxs)("div",{className:v,children:[(0,a.jsx)("button",{className:`${y} ${t?N:""}`,onClick:()=>{if(t)return;if(!J||!le)return;null!=ee.current&&(window.clearInterval(ee.current),ee.current=null),r(!0),T(!1),R(null);const n=(()=>{if("game"===e){const e=Math.floor(Math.random()*re.length);return{kind:"work",work:re[e]}}if("global"===G){const e=Math.floor(Math.random()*se.length),n=se[e];return{kind:"character",character:n,sourceWork:n.source_work_id&&ne.get(n.source_work_id)||null}}const n="singleWork"===q&&O?[O]:Array.from(ce.keys());if(0===n.length){const e=Math.floor(Math.random()*se.length),n=se[e];return{kind:"character",character:n,sourceWork:n.source_work_id&&ne.get(n.source_work_id)||null}}const t=n[Math.floor(Math.random()*n.length)],r=(ce.get(t)||[]).concat(te),a=r.length>0?r:se,o=a[Math.floor(Math.random()*a.length)];return{kind:"character",character:o,sourceWork:o.source_work_id?ne.get(o.source_work_id)||null:ne.get(t)||null}})(),a=2e3+2e3*Math.random(),o=Math.floor(a/100);let s=0;const c=window.setInterval((()=>{if(s<o){if("game"===e){const e=Math.floor(Math.random()*re.length),n=re[e];F(P(n.name_ko,n.name_en,n.name_ja))}else{const e=Math.floor(Math.random()*se.length),n=se[e];F(P(n.name_ko,n.name_en,n.name_ja))}s++}else window.clearInterval(c),ee.current=null,F("work"===n.kind?P(n.work.name_ko,n.work.name_en,n.work.name_ja):P(n.character.name_ko,n.character.name_en,n.character.name_ja)),r(!1),R(n),T(!0)}),100);ee.current=c},disabled:t||!le,children:t?"\uac00\ucc60 \uc911...":"\uac00\ucc60 \uc2dc\uc791!"}),(0,a.jsxs)("div",{className:M,children:[(0,a.jsx)("h3",{children:"\ud83c\udf89 \uacb0\uacfc \ud83c\udf89"}),(0,a.jsxs)("div",{className:C,children:[(0,a.jsx)("h4",{className:t?E:"",children:t?B:o?"work"===o.kind?P(o.work.name_ko,o.work.name_en,o.work.name_ja):P(o.character.name_ko,o.character.name_en,o.character.name_ja):"\uac00\ucc60\ub97c \uc2dc\uc791\ud574\uc8fc\uc138\uc694!"}),!t&&"character"===e&&!le&&(0,a.jsx)("p",{children:"\ub300\uc0c1 \uce90\ub9ad\ud130\uac00 \uc5c6\uc2b5\ub2c8\ub2e4."}),!t&&"work"===o?.kind&&(0,a.jsxs)("div",{className:S,children:[o.work.name_ja&&(0,a.jsxs)("div",{children:["JP: ",o.work.name_ja]}),o.work.name_en&&(0,a.jsxs)("div",{children:["EN: ",o.work.name_en]})]}),!t&&"character"===o?.kind&&(0,a.jsxs)("div",{className:S,children:[o.character.name_ja&&(0,a.jsxs)("div",{children:["JP: ",o.character.name_ja]}),o.character.name_en&&(0,a.jsxs)("div",{children:["EN: ",o.character.name_en]}),o.sourceWork&&(0,a.jsxs)("div",{className:W,children:["\uc791\ud488: ",P(o.sourceWork.name_ko,o.sourceWork.name_en,o.sourceWork.name_ja)]})]})]}),A&&o&&(0,a.jsx)("button",{className:$,onClick:ie,children:"\ub2e4\uc2dc \ud558\uae30"})]})]})})]})},D={id:"gacha",title:"\uac00\ucc60",sidebar_label:"\uac00\ucc60"},Q=void 0,Y={},Z=[{value:"\uac00\ucc60",id:"\uac00\ucc60",level:2}];function q(e){const n={h2:"h2",p:"p",...(0,o.R)(),...e.components};return(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(n.h2,{id:"\uac00\ucc60",children:"\uac00\ucc60"}),"\n",(0,a.jsx)(n.p,{children:"\uac8c\uc784\uc774\ub098 \uce90\ub9ad\ud130 \uac00\ucc60\uc785\ub2c8\ub2e4!"}),"\n",(0,a.jsx)(U,{})]})}function z(e={}){const{wrapper:n}={...(0,o.R)(),...e.components};return n?(0,a.jsx)(n,{...e,children:(0,a.jsx)(q,{...e})}):q(e)}}}]);